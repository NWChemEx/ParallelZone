

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Designing CommPP Class &mdash; parallelzone  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Hashing Design" href="hashing.html" />
    <link rel="prev" title="Designing RAM Class" href="ram.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            parallelzone
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../background/index.html">ParallelZone Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installing ParallelZone</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">ParallelZone User Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Design Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#high-level-design">High-Level Design</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#parallel-runtime-design">Parallel Runtime Design</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="parallel_runtime.html">Designing ParallelZone’s Parallel Runtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="runtime_view.html">Designing RuntimeView Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="resource_set.html">Designing ParallelZone’s ResourceSet Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="ram.html">Designing RAM Class</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html#mpi-helpers">MPI Helpers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#utilities-design">Utilities Design</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../initialize_finalize.html">Understanding Runtime Initialization/Finalization</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">parallelzone</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Developer Documentation</a></li>
          <li class="breadcrumb-item"><a href="index.html">Design Documentation</a></li>
      <li class="breadcrumb-item active">Designing CommPP Class</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/developer/design/compp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="designing-commpp-class">
<span id="compp-design"></span><h1>Designing CommPP Class<a class="headerlink" href="#designing-commpp-class" title="Link to this heading"></a></h1>
<p>The design specifications in <a class="reference internal" href="runtime_view.html#runtime-view-design"><span class="std std-ref">Designing RuntimeView Class</span></a> and <a class="reference internal" href="ram.html#ram-design"><span class="std std-ref">Designing RAM Class</span></a>
call for a <code class="docutils literal notranslate"><span class="pre">CommPP</span></code> class to take care of the MPI operations. Here we
discuss the design of the <code class="docutils literal notranslate"><span class="pre">CommPP</span></code> class.</p>
<section id="why-do-we-need-commpp">
<h2>Why Do We Need CommPP?<a class="headerlink" href="#why-do-we-need-commpp" title="Link to this heading"></a></h2>
<p>ParallelZone needs access to MPI. ParallelZone is object-oriented and needs
something to bridge the gap between objects and types recognized by MPI. At a
high-level this leads to serialization, but naive application of serializaiton
in an MPI context can lead to inefficiencies. CommPP should automate the
conversion from objects to MPI data types in the most efficient manner possible.</p>
</section>
<section id="design-considerations">
<h2>Design Considerations<a class="headerlink" href="#design-considerations" title="Link to this heading"></a></h2>
<p>The list below includes considerations from <a class="reference internal" href="runtime_view.html#runtime-view-design"><span class="std std-ref">Designing RuntimeView Class</span></a> and
from <a class="reference internal" href="ram.html#ram-design"><span class="std std-ref">Designing RAM Class</span></a>.</p>
<ol class="arabic simple">
<li><p>Support for all-to-all, all-to-one, and one-to-all MPI operations</p></li>
<li><p>Provide parallel primitives for building up more sophisticated infrastructure</p></li>
<li><p>SIMD API</p></li>
<li><p>Heavy use of template meta-programming to simplify API</p></li>
<li><p>Generic objects will need to be serialized.</p></li>
</ol>
</section>
<section id="commpp-architecture">
<h2>CommPP Architecture<a class="headerlink" href="#commpp-architecture" title="Link to this heading"></a></h2>
<figure class="align-center" id="id1">
<span id="fig-compp"></span><img alt="../../_images/compp.png" src="../../_images/compp.png" />
<figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text">Overall architecture of the CommPP class.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Conceptually the state of the CommPP class is simple. The only point of note
is that we use the PIMPL idiom to hide the MPI-based implementation from the
API. The tricky part of the <code class="docutils literal notranslate"><span class="pre">CommPP</span></code> class will be the conversion of objects
into a format suitable for consumption by MPI. Presently we adopt the lowest
common denominator, and transform all objects to binary.</p>
<figure class="align-center" id="id2">
<span id="fig-obj2binary"></span><img alt="../../_images/commpp_obj2binary.png" src="../../_images/commpp_obj2binary.png" />
<figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text">Schematic illustration of how CommPP converts an object into a binary
format.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#fig-obj2binary"><span class="std std-numref">Fig. 11</span></a> sketches out the object-to-binary process. On the left
we see two input scenarios depending on whether the object the user provided
needs serialized or not. If the object needs serialized <code class="docutils literal notranslate"><span class="pre">CommPP</span></code> uses the
object to initialize a <code class="docutils literal notranslate"><span class="pre">BinaryBuffer</span></code> object. If the object does not need
serialized <code class="docutils literal notranslate"><span class="pre">CommPP</span></code> initializes a <code class="docutils literal notranslate"><span class="pre">BinaryView</span></code> or a <code class="docutils literal notranslate"><span class="pre">ConstBinaryView</span></code>
instance depending on whether we need to mutate the object or not respectively.
<code class="docutils literal notranslate"><span class="pre">CommPP</span></code> then uses the <code class="docutils literal notranslate"><span class="pre">BinaryBuffer</span></code>, <code class="docutils literal notranslate"><span class="pre">BinaryView</span></code>, or
<code class="docutils literal notranslate"><span class="pre">ConstBinaryView</span></code> object to interact with MPI.</p>
<p>This design addresses the above concerns by:</p>
<ol class="arabic simple">
<li><p>Exposing the stated MPI operations in an object-oriented manner.</p></li>
<li><p>Not explicitly shown in the above architecture diagrams, but the APIs of
the <code class="docutils literal notranslate"><span class="pre">CommPP</span></code> class are envisioned as having a number of overloads for a
variety of scenarios. Choosing the optimal overload is a somewhat technical
detail, which is why <code class="docutils literal notranslate"><span class="pre">CommPP</span></code> is thought of as an implementation detail.</p></li>
<li><p>Proposed APIs are covered in <a class="reference internal" href="runtime_view.html#runtime-view-design"><span class="std std-ref">Designing RuntimeView Class</span></a> and <a class="reference internal" href="ram.html#ram-design"><span class="std std-ref">Designing RAM Class</span></a></p></li>
<li><p>Not explicitly shown, but it is expected that <code class="docutils literal notranslate"><span class="pre">CommPP</span></code> will use template-
meta programming to deduce whether to convert an object into a
<code class="docutils literal notranslate"><span class="pre">BinaryBuffer</span></code>, <code class="docutils literal notranslate"><span class="pre">BinaryView</span></code>, or <code class="docutils literal notranslate"><span class="pre">ConstBinaryView</span></code>.</p></li>
<li><p>Serialization happens under the hood and is the responsibility of the
<code class="docutils literal notranslate"><span class="pre">BinaryBuffer</span></code> class.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ram.html" class="btn btn-neutral float-left" title="Designing RAM Class" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hashing.html" class="btn btn-neutral float-right" title="Hashing Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, NWChemEx Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>